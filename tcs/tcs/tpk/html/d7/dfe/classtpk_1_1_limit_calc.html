<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>tpk: tpk::LimitCalc Class Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
    <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
    <li><a href="../../files.html"><span>Files</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="../../annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="../../hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="../../functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<b>tpk</b>::<a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html">LimitCalc</a></div>
<h1>tpk::LimitCalc Class Reference</h1><!-- doxytag: class="tpk::LimitCalc" --><code>#include &lt;LimitCalc.h&gt;</code>
<p>
<div class="dynheader">
Inheritance diagram for tpk::LimitCalc:</div>
<div class="dynsection">
<p><center><img src="../../d2/d4e/classtpk_1_1_limit_calc__inherit__graph.png" border="0" usemap="#d2/dac/tpk_1_1_limit_calc__inherit__map" alt="Inheritance graph"></center>
<map name="d2/dac/tpk_1_1_limit_calc__inherit__map">
<area shape="rect" href="../../d3/dee/classtpk_1_1_alt_az_limit_calc.html" title="Alt Az Time to limit calculator class." alt="" coords="16,80,149,107"><area shape="rect" href="../../dd/dff/classtpk_1_1_alt_az_rot_limit_calc.html" title="Alt Az and rotator Time to limit calculator class." alt="" coords="5,155,160,181"></map>
<center><font size="2">[<a href="../../graph_legend.html">legend</a>]</font></center></div>

<p>
<a href="../../d0/def/classtpk_1_1_limit_calc-members.html">List of all members.</a><hr><a name="_details"></a><h2>Detailed Description</h2>
Time to limit calculator class. 
<p>
A <a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html" title="Time to limit calculator class.">LimitCalc</a> object calculates the absolute time that the telescope mount or image rotator will reach one of its limits of travel given an initial roll, pitch and rotator mechanical angle. Full account is taken of non-sidereal motions of the target that is being tracked.<p>
The method used is to take a copy of the mount virtual telescope and "fast-forward" time until one of the limits is reached. However, choosing a suitable time interval is not straight-forward. Too small an interval results in execessive computation whereas too large an interval risks missing cases where an axis runs into a limit but then reverses direction and comes out of the limit again. (both a rotator and and pitch axis with a high limit less than 90 degress exhibit this behaviour).<p>
The strategy adopted here is to start with a fairly large interval (by by default around 10 minutes) and at each sample time test both the position at that time and the position extrapolated to the next sample time. If the extrapolated sample is beyond a limit, the sample interval is reduced so that the next sample cannot lie beyond the "turning point".<p>
It is still possible to miss a limit if the axis remains in the limit for less than the mimum sample interval (by default 1 second) but, in any case, the reliability of these calculations is limited by unpredictable effects such as changes in atmospheric conditions, guiding inputs and auxiliary inputs to the pointing model. Also, where the target tracks very close to the pole of the mount it is possible for the results to be completely wrong because it is impossible to predict which side of the pole the telescope will track.<p>
Calculating the mechanical position of an axis given a current position and a demand (taking into account cable wraps and the like) and determining whether a mechanical position is reachable or not are delegated to protected virtual methods. <table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#996ad6de502096934f019e8371482540">LimitCalc</a> (const <a class="el" href="../../df/d6e/classtpk_1_1_site.html">Site</a> &amp;site)</td></tr>

<tr><td colspan="2"><br><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="11099327b9969ce62b68ffeac83225dc"></a><!-- doxytag: member="tpk::LimitCalc::mDefStep" ref="11099327b9969ce62b68ffeac83225dc" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#11099327b9969ce62b68ffeac83225dc">mDefStep</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">default step size (days) <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="ac17b75eac92ebf3a50244de8d0bc235"></a><!-- doxytag: member="tpk::LimitCalc::mMinStep" ref="ac17b75eac92ebf3a50244de8d0bc235" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#ac17b75eac92ebf3a50244de8d0bc235">mMinStep</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">minimum step size (days) <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a37669d024b577c1ba8fb838be35df63"></a><!-- doxytag: member="tpk::LimitCalc::mMaxTrack" ref="a37669d024b577c1ba8fb838be35df63" args="" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#a37669d024b577c1ba8fb838be35df63">mMaxTrack</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">maximum tracking time (days) <br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5358bd60de558e744d1068d39b233d4c"></a><!-- doxytag: member="tpk::LimitCalc::noLimit" ref="5358bd60de558e744d1068d39b233d4c" args="" -->
static const int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#5358bd60de558e744d1068d39b233d4c">noLimit</a> = 0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">limit reason - no limit <br></td></tr>
<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">double&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#e363b2845fe35715bf45be55e20c43cf">limitTimeCalc</a> (double t0)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get time at which mechanical limit is reached.  <a href="#e363b2845fe35715bf45be55e20c43cf"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#f53a282e7a78716d799de5e3d8fdcee9">startLoop</a> (const <a class="el" href="../../df/d6e/classtpk_1_1_site.html">Site</a> &amp;site, const <a class="el" href="../../da/d6f/classtpk_1_1_time_keeper.html">TimeKeeper</a> &amp;timeKeeper)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start loop.  <a href="#f53a282e7a78716d799de5e3d8fdcee9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#7f524437eb504e255630cb9a76f3f80b">endLoop</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">End loop.  <a href="#7f524437eb504e255630cb9a76f3f80b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#4fa03647d8fb1f7fcaf1ca67f3a41ee0">inLimit</a> (double t)=0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get in limit status.  <a href="#4fa03647d8fb1f7fcaf1ca67f3a41ee0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#16adc82b810256437f83e8f9ebce38ca">closeToLimit</a> (double t)=0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get in limit status.  <a href="#16adc82b810256437f83e8f9ebce38ca"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="c54b3c2f77f67fef4bd10c4a596981f6"></a><!-- doxytag: member="tpk::LimitCalc::mSite" ref="c54b3c2f77f67fef4bd10c4a596981f6" args="" -->
const <a class="el" href="../../df/d6e/classtpk_1_1_site.html">Site</a> &amp;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#c54b3c2f77f67fef4bd10c4a596981f6">mSite</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">telescope site <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="91dc2a708d28bf82cd08ad19597efb03"></a><!-- doxytag: member="tpk::LimitCalc::mReason" ref="91dc2a708d28bf82cd08ad19597efb03" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#91dc2a708d28bf82cd08ad19597efb03">mReason</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">limit reason <br></td></tr>
</table>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="996ad6de502096934f019e8371482540"></a><!-- doxytag: member="tpk::LimitCalc::LimitCalc" ref="996ad6de502096934f019e8371482540" args="(const Site &amp;site)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">tpk::LimitCalc::LimitCalc           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../df/d6e/classtpk_1_1_site.html">Site</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>site</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>site</em>&nbsp;</td><td>
Telescope site </td></tr>
</table>
</dl>
</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="e363b2845fe35715bf45be55e20c43cf"></a><!-- doxytag: member="tpk::LimitCalc::limitTimeCalc" ref="e363b2845fe35715bf45be55e20c43cf" args="(double t0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double tpk::LimitCalc::limitTimeCalc           </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>t0</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get time at which mechanical limit is reached. 
<p>
If no limit is reached in the maximum tracking time then a time of zero is returned.<p>
If the current demands would put the telescope into a limit immediately then the start time is returned.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>absolute time (MJD, TAI) </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>t0</em>&nbsp;</td><td>
start time (TAI, MJD) </td></tr>
</table>
</dl>
</div>
</div><p>
<a class="anchor" name="f53a282e7a78716d799de5e3d8fdcee9"></a><!-- doxytag: member="tpk::LimitCalc::startLoop" ref="f53a282e7a78716d799de5e3d8fdcee9" args="(const Site &amp;site, const TimeKeeper &amp;timeKeeper)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void tpk::LimitCalc::startLoop           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../df/d6e/classtpk_1_1_site.html">Site</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>site</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../da/d6f/classtpk_1_1_time_keeper.html">TimeKeeper</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>timeKeeper</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Start loop. 
<p>
Performs any initialisation required before the search loop starts.<p>
The default implementation does nothing. <dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>site</em>&nbsp;</td><td>
site </td></tr>
<tr><td valign="top"><em>timeKeeper</em>&nbsp;</td><td>
time keeper </td></tr>
</table>
</dl>
<p>Reimplemented in <a class="el" href="../../d3/dee/classtpk_1_1_alt_az_limit_calc.html#a93da3be4332d4c15bcf578466ee1d33">tpk::AltAzLimitCalc</a>.</p>

</div>
</div><p>
<a class="anchor" name="7f524437eb504e255630cb9a76f3f80b"></a><!-- doxytag: member="tpk::LimitCalc::endLoop" ref="7f524437eb504e255630cb9a76f3f80b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void tpk::LimitCalc::endLoop           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
End loop. 
<p>
Performs any cleanup needed after the search loop completes.<p>
The default implementation does nothing. 
<p>Reimplemented in <a class="el" href="../../d3/dee/classtpk_1_1_alt_az_limit_calc.html#1a36f17424853980c8458235c6062c6e">tpk::AltAzLimitCalc</a>.</p>

</div>
</div><p>
<a class="anchor" name="4fa03647d8fb1f7fcaf1ca67f3a41ee0"></a><!-- doxytag: member="tpk::LimitCalc::inLimit" ref="4fa03647d8fb1f7fcaf1ca67f3a41ee0" args="(double t)=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int tpk::LimitCalc::inLimit           </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>t</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get in limit status. 
<p>
This method determines whether or not the the axes have encountered a limit at the specified time.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>limit flags </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>t</em>&nbsp;</td><td>
time (TAI, MJD) </td></tr>
</table>
</dl>
<p>Implemented in <a class="el" href="../../d3/dee/classtpk_1_1_alt_az_limit_calc.html#aaef32a12a2c2b8f45c26732169fab73">tpk::AltAzLimitCalc</a>, and <a class="el" href="../../dd/dff/classtpk_1_1_alt_az_rot_limit_calc.html#08bbeb4e0cb5d3ffef8fe36e716b3233">tpk::AltAzRotLimitCalc</a>.</p>

</div>
</div><p>
<a class="anchor" name="16adc82b810256437f83e8f9ebce38ca"></a><!-- doxytag: member="tpk::LimitCalc::closeToLimit" ref="16adc82b810256437f83e8f9ebce38ca" args="(double t)=0" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual int tpk::LimitCalc::closeToLimit           </td>
          <td>(</td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>t</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get in limit status. 
<p>
This method determines whether or not the the axes might have encountered a limit at the specified offset from the time of the last call to inLimit. This method is normally implemented by extrapolating the from the position last calculated by <a class="el" href="../../d7/dfe/classtpk_1_1_limit_calc.html#4fa03647d8fb1f7fcaf1ca67f3a41ee0" title="Get in limit status.">inLimit()</a> using the velocity at that time.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>limit flags </dd></dl>
<dl compact><dt><b>Parameters: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em>t</em>&nbsp;</td><td>
time (TAI, MJD) </td></tr>
</table>
</dl>
<p>Implemented in <a class="el" href="../../d3/dee/classtpk_1_1_alt_az_limit_calc.html#27e803c77dd8324b0f879c542255dc7c">tpk::AltAzLimitCalc</a>, and <a class="el" href="../../dd/dff/classtpk_1_1_alt_az_rot_limit_calc.html#56d249b217bade30a0798fc6e5dd1cad">tpk::AltAzRotLimitCalc</a>.</p>

</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="../../d6/d95/_limit_calc_8h.html">LimitCalc.h</a><li><a class="el" href="../../dd/dcc/_limit_calc_8cpp.html">LimitCalc.cpp</a></ul>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 10 10:18:51 2007 for tpk by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
